---
title: 概率期望初步
date: 2022-11-06 09:04:51
description: 概率期望对我来说一直都是比较玄的一部分内容，希望这篇文章能对你有帮助！
tags:
	- 概率
	- 期望
categories:
	- 知识点
mathjax: true
urlname: probability-expectation-intial
---

## 前言

关于概率和数论的内容一直都困扰了我很久，所以我就写了这几篇文章来记录一下我是怎么解决困惑的，希望对你有帮助！

## 概念

这一部分我简单过一下，不了解的可以去看[这篇](https://www.luogu.com.cn/blog/ShineEternal/mathematical-expectation)文章。

### 随机变量

通常来说，我们对于一道题，都不会直接算事件的期望，而是定义随机变量然后再算期望。

### 概率

这个大家应该都会吧，不用多说。

下面我们用的记号一般都是：$P(X=a)$ 表示 $X$ 的值为 $a$ 的概率。

### 期望

期望的定义就是 $E(X) = \sum_{a} a\cdot P(X=a)$，由这个可以推出许多性质：

- $E(cX) = cE(X)$，其中 $c$ 是常数
- $E(X+Y) = E(X)+E(Y)$
- $E(XY) = E(X)\cdot E(Y)$，要求 $X,Y$ 独立
- $E(c) = c$，其中 $c$ 为常数

## 引入

### 抛骰子

> 有一个骰子，问抛出的点数的期望。

超级~~大水题~~简单入门题。

我们令 $X$ 表示抛出点数。这是一个随机变量，所以直接按照公式算：

$$
E(X) = \sum_{v} v\cdot P(X=v) = 1 \cdot \frac 16 + 2 \cdot \frac 16 + \cdots + 6 \cdot \frac 16 = \frac 72
$$

> 有两个骰子，问抛出点数和的期望。

抛出的点数有可能是 $1\sim 12$，那是不是说明抛出 $i$ 的概率就是 $\frac{1}{12}$？显然不是的，因为这 $12$ 个点数不是等概率的。看这个表：

|       | **1** | **2** | **3** | **4** | **5** | **6** |
|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
| **1** |   2   |   3   |   4   |   5   |   6   |   7   |
| **2** |   3   |   4   |   5   |   6   |   7   |   8   |
| **3** |   4   |   5   |   6   |   7   |   8   |   9   |
| **4** |   5   |   6   |   7   |   8   |   9   |   10  |
| **5** |   6   |   7   |   8   |   9   |   10  |   11  |
| **6** |   7   |   8   |   9   |   10  |   11  |   12  |

我们发现每个点数出现的次数不全是一样的，这就导致我们只能硬算期望：

$E(X) = \sum_{v} v \cdot E(X=v) = 2 \cdot \frac{1}{36} + 3 \cdot \frac{2}{36} + \cdots + 12 \cdot \frac{1}{36} = 7$。~~啊算死我了~~

这样是不是有点麻烦呢？但是前面我们知道，期望是有线性性的（即 $E(X + Y) = E(X) + E(Y)$），所以我们可以定义 $X$ 表示第一个骰子的点数，类似地定义 $Y$ 表示第二个骰子的点数。那么 $E(X + Y) = E(X) + E(Y) = \frac 72 + \frac 72 = 7$。

通过这种方式，我们还可以类似地求出 $n$ 个骰子的期望是 $\frac 72 n$

### 三门问题

经典的例题了。

> 有 A,B,C 三个门，其中一个门后面有一辆轿车（等概率）。嘉宾可以从中任选一个门，如果轿车在这个门后，你就可以将车作为奖品开回家。当你做出选择之后，主持人会从剩下两个门中选择一个**没有车的**打开。（**主持人知道哪个门后有车**）请问此时你选择的门后有轿车的概率是多少呢？你没有选的那第三扇门后有轿车的概率又是多少呢？

直觉上来讲都是 $\frac 12$，因为还剩两个门嘛，所以当然是 $\frac 12$ 啦。

看起来没有什么问题，但是实际上是有问题的。

#### 经典错误

我们设事件 $P$ 为`嘉宾的门后有车`，$Q$ 为`主持人选的门后没车`。我们把所有情况中满足 $Q$ 的全挑出来，然后找到其中有多少个满足 $P$ 的。

我们给三个门编号为 $A,B,C$，并不妨设嘉宾选的是 $A$。我们把满足 $Q$ 的列出来：

- 嘉宾选了 $A$，车在 $A$，主持人开了 $B$
- 嘉宾选了 $A$，车在 $A$，主持人开了 $C$
- 嘉宾选了 $A$，车在 $B$，主持人开了 $C$
- 嘉宾选了 $A$，车在 $C$，主持人开了 $B$

然后其中满足 $P$ 的有（加粗的是满足 $P$ 的）：

- **嘉宾选了 $A$，车在 $A$，主持人开了 $B$**
- **嘉宾选了 $A$，车在 $A$，主持人开了 $C$**
- 嘉宾选了 $A$，车在 $B$，主持人开了 $C$
- 嘉宾选了 $A$，车在 $C$，主持人开了 $B$

看起来好像是 $\frac 12$ 啊，怎么回事呢？

#### 正确方法

事实上，由于主持人是知道哪个门后有车的，所以主持人的选择其实不是完全随机的，比如说当 $B,C$ 中有一辆车时，主持人其实是没得选的。所以说我们算的其实**并不是**条件概率 $P(P|Q)$。

正确做法是，先列出所有情况：

- 嘉宾选了 $A$，车在 $A$（$P=\frac 13$）
- 嘉宾选了 $A$，车在 $B$（$P=\frac 13$）
- 嘉宾选了 $A$，车在 $C$（$P=\frac 13$）

然后考虑主持人的选法：

- 嘉宾选了 $A$，车在 $A$
  - 主持人选了 $B$（$P=\frac 16$）
  - 主持人选了 $C$（$P=\frac 16$）
- 嘉宾选了 $A$，车在 $B$，主持人选了 $C$（$P=\frac 13$）
- 嘉宾选了 $A$，车在 $C$，主持人选了 $B$（$P=\frac 13$）

选择这道题的初衷是让大家理解清楚概率的定义，不至于下面的题想偏。

### ARC150D Removing Gacha

{% note no-icon info %}

本节内容参考自 <https://huanyp.cn/2022/10/10/比赛题解总结感悟/ARC150D-一类期望问题的思考方式/>。

另外，选择这道题是想指出一种错误的想法，并不在这道题的做法本身。

{% endnote %}


> 给定一棵树，初始每个点都没被选中。每次会选择一个点，满足**它或它的任意一个祖先**未被选中。如果这个点未被选中，就会选中该点。求使所有点被选中的期望次数，对 $998244353$ 取模。

#### 错误想法

考虑枚举排列（结点被涂黑的顺序），然后对于每个排列算期望。

先假设只有 $3$ 个点，形成一条链（顺序 $1,2,3$），且排列为 $3,2,1$。

首先选到 $3$ 的期望次数为 $1$，这是显然的。然后选到 $2$ 的期望是多少呢？因为此时只能选 $2,3$，所以选到 $2$ 的概率是 $\frac 12$，所以期望是 $2$。看起来很有道理，但其实是错的。

#### 正确思路

为什么错了呢？容易发现所有满足条件的操作序列都是如下形式的：（$2|3$ 表示 $2$ 或 $3$；$x^*$ 表示若干个 $x$，可能是 $0$ 个）

$3,3^*,2,(2|3)^*,1$

考虑我们已经选了第一个 $3$，那么第二个如果是 $3$，那合法的操作序列是这样的：

$3,3,3^*,2,(2|3)^*,1$

而如果第二个是 $2$，那合法的操作序列是这样的：

$3,2,(2|3)^*,1$

在所有操作序列中，选到第一个操作序列的概率是 $\frac 13 \cdot \frac 13 \cdot d$

#### 简单主流做法

{% note no-icon info %}

这一节不是这道题的主要内容，故不详细讲。

{% endnote %}


## 参考资料

{% note info %}

<https://huanyp.cn/2022/10/10/算法总结理解/概率期望-三门问题及其变形/>  
<https://huanyp.cn/2022/10/10/比赛题解总结感悟/ARC150D-一类期望问题的思考方式/>  
<https://www.luogu.com.cn/blog/ShineEternal/mathematical-expectation>  
<https://oi-wiki.org/math/probability/basic-conception/>  
<https://oi-wiki.org/math/probability/conditional-probability/>  
<https://oi-wiki.org/math/probability/random-variable/>

{% endnote %}
<!--
P5644
AGC050D
ABC263
P5643
CF335E

CF917D
CF360D
-->